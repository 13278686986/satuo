import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.image.BufferedImage;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;

public class Java11ChristmasEffect extends JFrame {
    private final int WIDTH = 800;
    private final int HEIGHT = 600;
    private Random random = new Random();
    private BufferedImage bufferImage;
    private Graphics2D g2d;
    private List<TreeParticle> treeParticles = new ArrayList<>();
    private List<Snowflake> snowflakes = new ArrayList<>();
    private List<Firework> fireworks = new ArrayList<>();
    private int currentTheme = 0; // 0:蓝, 1:金, 2:红
    private Color[] themeBg = {new Color(0, 26, 51), new Color(26, 15, 0), new Color(51, 0, 0)};
    private Color[] themeTree = {new Color(0, 204, 255), new Color(255, 204, 0), new Color(255, 0, 0)};
    private Color[] themeText = {Color.WHITE, new Color(255, 215, 0), Color.RED};
    private int sceneTimer = 0;
    private JLabel textLabel1, textLabel2;

    // 圣诞树粒子类
    class TreeParticle {
        double x, y, size;
        Color color;

        TreeParticle(double x, double y, Color color, double size) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.size = size;
        }

        void update() {
            size = Math.sin(System.currentTimeMillis() / 100.0) * 0.5 + 1.5;
        }

        void draw() {
            g2d.setColor(color);
            g2d.fillOval((int) (x - size / 2), (int) (y - size / 2), (int) size, (int) size);
        }
    }

    // 雪花类
    class Snowflake {
        double x, y, size, vx, vy;

        Snowflake(double x, double y, double size, double vx, double vy) {
            this.x = x;
            this.y = y;
            this.size = size;
            this.vx = vx;
            this.vy = vy;
        }

        void update() {
            x += vx;
            y += vy;
            if (y > HEIGHT) y = 0;
            if (x < 0 || x > WIDTH) x = random.nextDouble() * WIDTH;
        }

        void draw() {
            g2d.setColor(Color.WHITE);
            g2d.fillOval((int) (x - size / 2), (int) (y - size / 2), (int) size, (int) size);
        }
    }

    // 烟花类
    class Firework {
        double x, y, size, vx, vy;
        Color color;
        int life;

        Firework(double x, double y, Color color, double size, double vx, double vy, int life) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.size = size;
            this.vx = vx;
            this.vy = vy;
            this.life = life;
        }

        void update() {
            x += vx;
            y += vy;
            life--;
            size -= 0.05;
        }

        void draw() {
            g2d.setColor(new Color(
                    color.getRed(),
                    color.getGreen(),
                    color.getBlue(),
                    (int) (255.0 * life / 60.0)
            ));
            g2d.fillOval((int) (x - size / 2), (int) (y - size / 2), (int) size, (int) size);
        }

        boolean isAlive() {
            return life > 0 && size > 0;
        }
    }

    // 创建螺旋圣诞树
    private void createChristmasTree() {
        double centerX = WIDTH / 2;
        double centerY = HEIGHT / 2 + 50;
        Color treeColor = themeTree[currentTheme];
        double angle = 0;
        double radius = 10;
        double maxRadius = 150;
        double step = 0.1;

        for (int i = 0; i < 200; i++) {
            radius += step;
            angle += 0.1;
            if (radius > maxRadius) break;
            double x = centerX + Math.cos(angle) * radius;
            double y = centerY - Math.sin(angle) * radius;
            double size = random.nextDouble() * 2 + 1;
            treeParticles.add(new TreeParticle(x, y, treeColor, size));
        }

        // 树顶星星
        for (int i = 0; i < 5; i++) {
            double angleStar = (i * 72) * Math.PI / 180;
            double x = centerX + Math.cos(angleStar) * 30;
            double y = centerY - maxRadius - 20 + Math.sin(angleStar) * 30;
            treeParticles.add(new TreeParticle(x, y, Color.WHITE, 3));
        }
    }

    // 创建雪花
    private void createSnowflakes() {
        for (int i = 0; i < 50; i++) {
            double x = random.nextDouble() * WIDTH;
            double y = random.nextDouble() * HEIGHT;
            double size = random.nextDouble() * 3 + 1;
            double vx = random.nextDouble() * 0.5 - 0.25;
            double vy = random.nextDouble() * 2 + 1;
            snowflakes.add(new Snowflake(x, y, size, vx, vy));
        }
    }

    // 创建烟花
    private void createFirework() {
        double x = random.nextDouble() * WIDTH;
        double y = random.nextDouble() * HEIGHT;
        Color fireColor = themeTree[currentTheme];
        fireworks.add(new Firework(x, y, fireColor, 5, 0, 0, 60));

        // 烟花爆炸粒子
        int particleCount = 80;
        for (int i = 0; i < particleCount; i++) {
            double angle = random.nextDouble() * Math.PI * 2;
            double speed = random.nextDouble() * 5 + 2;
            double vx = Math.cos(angle) * speed;
            double vy = Math.sin(angle) * speed;
            fireworks.add(new Firework(x, y, fireColor, 2, vx, vy, 60));
        }
    }

    // 切换主题
    private void switchTheme() {
        currentTheme = (currentTheme + 1) % 3;
        treeParticles.clear();
        createChristmasTree();
        textLabel1.setForeground(themeText[currentTheme]);
        textLabel2.setForeground(themeText[currentTheme]);
        setBackground(themeBg[currentTheme]);
    }

    // 显示文字
    private void showText() {
        textLabel1.setVisible(true);
        textLabel2.setVisible(true);
        Timer hideTimer = new Timer(3000, e -> {
            textLabel1.setVisible(false);
            textLabel2.setVisible(false);
        });
        hideTimer.setRepeats(false);
        hideTimer.start();
    }

    public Java11ChristmasEffect() {
        setTitle("Java 11 圣诞特效");
        setSize(WIDTH, HEIGHT);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        setResizable(false);
        setBackground(themeBg[0]);

        bufferImage = new BufferedImage(WIDTH, HEIGHT, BufferedImage.TYPE_INT_ARGB);
        g2d = bufferImage.createGraphics();
        g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

        createChristmasTree();
        createSnowflakes();

        textLabel1 = new JLabel("Merry Christmas");
        textLabel1.setFont(new Font("Arial", Font.BOLD, 24));
        textLabel1.setForeground(themeText[0]);
        textLabel1.setBounds(WIDTH / 2 - 100, HEIGHT / 2 - 50, 200, 30);
        textLabel1.setVisible(false);

        textLabel2 = new JLabel("圣诞节·最好的圣诞祝福送给你");
        textLabel2.setFont(new Font("Arial", Font.PLAIN, 18));
        textLabel2.setForeground(themeText[0]);
        textLabel2.setBounds(WIDTH / 2 - 120, HEIGHT / 2, 240, 30);
        textLabel2.setVisible(false);

        add(textLabel1);
        add(textLabel2);

        Timer timer = new Timer(16, new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                g2d.clearRect(0, 0, WIDTH, HEIGHT);

                snowflakes.forEach(Snowflake::update);
                snowflakes.forEach(Snowflake::draw);

                treeParticles.forEach(TreeParticle::update);
                treeParticles.forEach(TreeParticle::draw);

                fireworks.forEach(Firework::update);
                fireworks.removeIf(f -> !f.isAlive());
                fireworks.forEach(Firework::draw);

                if (Math.random() > 0.95) {
                    createFirework();
                }

                sceneTimer++;
                if (sceneTimer >= 1200) {
                    sceneTimer = 0;
                    switchTheme();
                    showText();
                }

                repaint();
            }
        });
        timer.start();
    }

    @Override
    public void paint(Graphics g) {
        g.drawImage(bufferImage, 0, 0, this);
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            new Java11ChristmasEffect().setVisible(true);
        });
    }
}